# SSE

## SSEë€ ?

SEEëŠ” ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜, 'ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸'ë¡œ 'ë‹¨ë°©í–¥'ìœ¼ë¡œ 'ì‹¤ì‹œê°„' ì´ë²¤íŠ¸ë¥¼ ì „ì†¡í•˜ëŠ” 'ì›¹' ê¸°ìˆ ì´ë‹¤. SEEëŠ” ë‹¨ë°©í–¥ í†µì‹  ë°©ì‹ìœ¼ë¡œ ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ë¡œ ë°ì´í„°ë¥¼ ì „ì†¡í•œë‹¤.
![](https://velog.velcdn.com/images/sju4486/post/f383da88-95f8-4e7e-a38f-ec6b70dfa399/image.png)

## SSEì˜ íŠ¹ì§•

- **ë‹¨ë°©í–¥ í†µì‹  :** SSEëŠ” ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ë¡œ ë°ì´í„°ë¥¼ ë³´ë‚´ëŠ” ë‹¨ë°©í–¥ í†µì‹  ë°©ì‹ì´ë‹¤. ì´ê²ƒì€ í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ì— ìš”ì²­ì„ ë³´ë‚´ì§€ ì•Šê³ ë„ ì„œë²„ê°€ ë°ì´í„°ë¥¼ í´ë¼ì´ì–¸íŠ¸ë¡œ ë³´ë‚¼ ìˆ˜ ìˆìŒì„ ì˜ë¯¸í•œë‹¤.

- **í…ìŠ¤íŠ¸ ê¸°ë°˜ :** SSEëŠ” í…ìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ì£¼ë¡œ ì „ì†¡í•œë‹¤. ì´ëŠ” ì£¼ë¡œ JSON í˜•ì‹ ë˜ëŠ” ë‹¤ë¥¸ í…ìŠ¤íŠ¸ ê¸°ë°˜ ë°ì´í„° í˜•ì‹ì„ ì‚¬ìš©í•˜ì—¬ ì •ë³´ë¥¼ í´ë¼ì´ì–¸íŠ¸ë¡œ ë³´ë‚´ëŠ” ë° ì‚¬ìš©ëœë‹¤.

- **ì´ë²¤íŠ¸ ê¸°ë°˜ :** SSEëŠ” ì´ë²¤íŠ¸ ê¸°ë°˜ìœ¼ë¡œ ì‘ë™í•˜ë©°, ì„œë²„ëŠ” í´ë¼ì´ì–¸íŠ¸ë¡œ ì´ë²¤íŠ¸ ë©”ì‹œì§€ë¥¼ ë³´ë‚¸ë‹¤. í´ë¼ì´ì–¸íŠ¸ëŠ” ì´ë²¤íŠ¸ ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ í•˜ê³  ì²˜ë¦¬í•  ìˆ˜ ìˆìœ¼ë©°, ì´ë²¤íŠ¸ ì´ë¦„ê³¼ ë°ì´í„°ë¥¼ í¬í•¨í•œë‹¤.

- **ë°ì´í„° ìŠ¤íŠ¸ë¦¼ :** SSEëŠ” ë°ì´í„°ë¥¼ ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ì „ì†¡í•˜ë¯€ë¡œ, ì„œë²„ê°€ ì£¼ê¸°ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë³´ë‚´ëŠ” ë™ì•ˆ í´ë¼ì´ì–¸íŠ¸ëŠ” ì—°ê²°ì„ ìœ ì§€í•˜ê³  ë°ì´í„°ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ìˆ˜ì‹ í•  ìˆ˜ ìˆë‹¤.

- **ê°„ë‹¨í•œ êµ¬í˜„ :** SSEëŠ” ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ ë‚´ì¥ëœ í‘œì¤€ APIë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ê°„ë‹¨í•œ ì„œë²„ ë° í´ë¼ì´ì–¸íŠ¸ ì½”ë“œë¡œ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

## SSEì™€ ì›¹ì†Œì¼“ ì°¨ì´ì 

SSEì™€ WebSocketì€ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì‹¤ì‹œê°„ í†µì‹ ì„ ì§€ì›í•˜ëŠ” ê¸°ìˆ ì´ì§€ë§Œ ì¤‘ìš”í•œ ì°¨ì´ì ì´ ìˆë‹¤.

SSEëŠ” ë‹¨ë°©í–¥ í†µì‹ ìœ¼ë¡œ, ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ë¡œ ë°ì´í„°ë¥¼ í‘¸ì‹œí•˜ê³  HTTP í”„ë¡œí† ì½œ ìœ„ì—ì„œ ë™ì‘í•œë‹¤. ì£¼ë¡œ ë‹¨ë°©í–¥ ë°ì´í„° ìŠ¤íŠ¸ë¦¬ë°ì„ ìœ„í•´ ì‚¬ìš©ë˜ê³  ì£¼ê¸°ì ì¸ ì—…ë°ì´íŠ¸ë¥¼ ì œê³µí•˜ëŠ” ë° ìœ ìš©í•˜ë‹¤. ë°˜ë©´ WebSocketì€ ì–‘ë°©í–¥ í†µì‹ ì„ ì§€ì›í•˜ê³  WebSocket í”„ë¡œí† ì½œì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ì£¼ê³ ë°›ìœ¼ë¯€ë¡œ ì–‘ë°©í–¥ í†µì‹  ë° ì‹¤ì‹œê°„ ìƒí˜¸ì‘ìš©ì— ì í•©í•˜ë‹¤. **SSEëŠ” ì£¼ë¡œ ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ë¡œ ë°ì´í„° í‘¸ì‹œì— ì‚¬ìš©**ë˜ê³ , **WebSocketì€ ì‹¤ì‹œê°„ ì±„íŒ…, ì˜¨ë¼ì¸ ê²Œì„ ë“±ì˜ ìƒí˜¸ì‘ìš© ê¸°ëŠ¥ì— ì‚¬ìš©**ëœë‹¤.

![](https://velog.velcdn.com/images/sju4486/post/2b4bb295-dd6c-425b-8d5c-bbac24283ef2/image.png)

## SSEì™€ í´ë§ ì°¨ì´ì 

í´ë§ê³¼ SSEëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì„œë²„ì™€ì˜ í†µì‹  ë°©ì‹ì„ ë‹¤ë¥´ê²Œ ë‹¤ë£¨ëŠ” ê¸°ìˆ ì´ë‹¤. í´ë§ì€ í´ë¼ì´ì–¸íŠ¸ê°€ ì£¼ê¸°ì ìœ¼ë¡œ ì„œë²„ì— ë°ì´í„°ë¥¼ ìš”ì²­í•˜ê³  ë°ì´í„° ì—…ë°ì´íŠ¸ë¥¼ í™•ì¸í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ, ì—…ë°ì´íŠ¸ì— ëŒ€í•œ ì§€ì—°ê³¼ ë¶ˆí•„ìš”í•œ íŠ¸ë˜í”½ì„ ì´ˆë˜í•  ìˆ˜ ìˆë‹¤. ë°˜ë©´ SSEëŠ” ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ë¡œ ë°ì´í„°ë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ í‘¸ì‹œí•˜ë¯€ë¡œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ê°€ ê°€ëŠ¥í•˜ë©°, í´ë¼ì´ì–¸íŠ¸ëŠ” ìš”ì²­ì„ ë³´ë‚´ì§€ ì•Šê³  ë°ì´í„°ë¥¼ ìˆ˜ì‹ í•œë‹¤. SSEëŠ” ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ì™€ ë°ì´í„°ì˜ ì‹¤ì‹œê°„ í‘¸ì‹œì— íš¨ê³¼ì ì´ë©°, êµ¬í˜„ì´ ê°„ë‹¨í•œ ì¥ì ì„ ê°€ì§„ë‹¤.

## SSE ì‚¬ìš©í•´ë³´ê¸°

**`ë°ì´í„° í¬ë©§`**

```js
id: testN1\n
event: red\n
data: {"message" : "hello SSE!", "text" : "blah-blah"}\n\n
```

**`server.js`**

```js
// ë¨¼ì € í•´ë”ë¥¼ ì•„ë˜ì™€ ê°™ì´ ë³´ë‚´ì•¼ í•œë‹¤.
const headers = {
  "Content-Type": "text/event-stream",
  Connection: "keep-alive",
  "Cache-Control": "no-cache",
};
```

```js
res.writeHead(200, headers);

const clientId = request.query.clientId;
clients[clientId] = {
  response,
};
request.on("close", () => {
  delete clients[clientId];
});
```

```js
// ì´ì œ ì„œë²„ì—ì„œ ì–´ë–¤ ì´ë²¤íŠ¸ê°€ ë°œìƒ í–ˆì„ ë•Œ ë°ì´í„° í´ë¼ì´ì–¸íŠ¸ë¡œ ë³´ë‚´ê¸°
// ì˜ˆì‹œ ì„œë²„ ìµœì´ˆ 9+ ê°•í™” ì„±ê³µ
const notifyUser = (req, res) => {
  const payload = {...}
  clients.forEach(client =>
  	client.response.write(`data: ${JSON.stringify(payload)}\n\n`)
}
```

> ğŸ’¡ **ë²„í¼ ì—†ì• ê¸°**
>
> HTTP header - X-Accel-Buffering: no </br>
> ngnix config - proxy_buffering off

**`client`**

```js
useEffect(() => {
  // ë„ˆì™€ ë‚˜ì˜ ì—°ê²°ê³ ë¦¬ ë§Œë“¤ì–´ ì£¼ê¸°
  const sseEvents = new EventSource("http://localhost:3000/sse");

  sseEvents.onopen = function () {
    // ì—°ê²° ëì„ ë•Œ
  };
  sseEvents.onerror = function (error) {
    // ì—ëŸ¬ ë‚¬ì„ ë•Œ
  };
  sseEvents.onmessage = function (stream) {
    // ë©”ì„¸ì§€ ë°›ì•˜ì„ ë•Œ
    const parsedData = JSON.parse(stream.data);
  };
}, []);
```

## ì°¸ê³ 

- https://suzzeong.tistory.com/86
- [ì›¹ì†Œì¼“ ê³¼ SSE(Server-Sent-Event) ì°¨ì´ì  ì•Œì•„ë³´ê³  ì‚¬ìš©í•´ë³´ê¸°](https://surviveasdev.tistory.com/entry/%EC%9B%B9%EC%86%8C%EC%BC%93-%EA%B3%BC-SSEServer-Sent-Event-%EC%B0%A8%EC%9D%B4%EC%A0%90-%EC%95%8C%EC%95%84%EB%B3%B4%EA%B3%A0-%EC%82%AC%EC%9A%A9%ED%95%B4%EB%B3%B4%EA%B8%B0)
- https://lotuus.tistory.com/151
